# 系统设计

系统设计是后端工程师的核心能力，也是面试的重点。本模块深入讲解系统设计的核心概念、实战方案和面试技巧。

## 📚 学习文档

### ✅ 已完成

1. **[可扩展性与高可用设计](./01-scalability-availability.md)** (40KB)
   - 垂直扩展 vs 水平扩展
   - 无状态设计
   - 数据分片（Sharding）
   - 读写分离
   - 负载均衡算法
   - 故障转移（Failover）
   - 健康检查
   - 熔断器（Circuit Breaker）
   - 降级策略
   - 限流（Rate Limiting）
   - Node.js 完整实现
   - 5+ 道高频面试题

2. **[缓存策略](./02-caching-strategies.md)** (38KB)
   - 4 种缓存模式（Cache-Aside、Read-Through、Write-Through、Write-Behind）
   - 缓存更新策略（延迟双删、版本号）
   - 缓存三大问题及解决方案：
     - 缓存穿透（布隆过滤器、缓存空值）
     - 缓存击穿（互斥锁、永不过期）
     - 缓存雪崩（随机 TTL、多级缓存）
   - 多级缓存架构
   - 缓存监控指标
   - 完整的缓存管理系统实现
   - 5+ 道高频面试题

3. **[分布式系统](./03-distributed-systems.md)** (42KB)
   - CAP 理论（CP vs AP）
   - BASE 理论（最终一致性）
   - 分布式事务：
     - 2PC（两阶段提交）
     - TCC（Try-Confirm-Cancel）
     - Saga 模式
     - 本地消息表
   - 分布式锁：
     - Redis 分布式锁
     - Redlock 算法
     - 数据库分布式锁
   - 分布式 ID：
     - UUID、Snowflake、ObjectId、数据库自增
   - Raft 算法简介
   - 分布式任务调度器实现
   - 5+ 道高频面试题

4. **[数据库设计](./04-database-design.md)** (45KB)
   - 三范式与反范式化
   - 索引设计：
     - B+树原理
     - 单列索引、复合索引、唯一索引、全文索引
     - 最左前缀原则
     - 索引覆盖
     - 索引失效场景
   - 查询优化：
     - EXPLAIN 分析
     - 避免 N+1 查询
     - 分页优化（游标分页）
     - 批量操作
   - 分库分表：
     - 垂直拆分、水平拆分
     - 范围分表、哈希分表、时间分表
     - Sharding 实现
   - 读写分离架构
   - 主从复制延迟处理
   - 完整的企业级数据库管理系统
   - 5+ 道高频面试题

5. **[实战案例](./05-real-world-cases.md)** (48KB) ⭐ 新增
   - **秒杀系统**：
     - 前端限流、网关限流
     - Redis 预扣库存（Lua 脚本）
     - 异步创建订单
     - 库存补偿机制
   - **短链接系统**：
     - Base62 编码、哈希算法、随机生成
     - 布隆过滤器防重
     - 高性能查询（缓存 + 布隆过滤器）
     - 点击统计（批量同步）
   - **分布式限流系统**：
     - 固定窗口、滑动窗口、令牌桶
     - 多级限流
   - **实时消息系统（IM）**：
     - WebSocket 服务器
     - Redis Pub/Sub
     - 离线消息推送
     - 群聊实现
   - **新闻推送系统**：
     - 推拉结合（Fan-out + 推荐）
     - Timeline 设计
     - 混合模式
   - **系统设计面试技巧**

## 📝 知识点清单

### 设计原则
- [x] 可扩展性（Scalability）
- [x] 可用性（Availability）
- [x] 可靠性（Reliability）
- [x] 一致性（Consistency）
- [x] 性能（Performance）
- [x] 可维护性（Maintainability）

### 理论基础
- [x] CAP 理论
- [x] BASE 理论
- [x] ACID 特性
- [x] 最终一致性
- [x] Raft 算法

### 高可用设计
- [x] 故障转移（Failover）
- [x] 备份与恢复
- [x] 健康检查
- [x] 降级策略
- [x] 熔断机制
- [x] 限流
- [x] 超时与重试

### 高并发设计
- [x] 水平扩展 vs 垂直扩展
- [x] 无状态设计
- [x] 负载均衡
- [x] 数据库读写分离
- [x] 数据库分库分表
- [x] 连接池
- [x] 异步处理
- [x] 消息队列削峰

### 缓存策略
- [x] 缓存模式（Cache-Aside, Write-Through, Write-Behind）
- [x] 缓存更新策略
- [x] 缓存穿透、击穿、雪崩
- [x] 多级缓存
- [x] CDN 缓存

### 数据库设计
- [x] 数据建模（范式与反范式）
- [x] 索引设计
- [x] 查询优化
- [x] 分库分表
- [x] 读写分离
- [x] 主从复制
- [x] 数据一致性

### 分布式系统
- [x] 分布式一致性
- [x] 分布式事务（2PC、TCC、Saga）
- [x] 分布式锁
- [x] 分布式 ID
- [x] 服务注册与发现

### 实战案例
- [x] 秒杀系统
- [x] 短链接系统
- [x] 分布式限流系统
- [x] 实时消息系统
- [x] 新闻推送系统

## 🎯 学习建议

### 基础阶段（必修）
1. 理解 CAP 和 BASE 理论
2. 掌握缓存策略和使用场景
3. 学习数据库设计和优化
4. 理解分布式系统基本概念

### 进阶阶段（深入）
1. 深入分布式事务和一致性
2. 实现分布式锁和分布式 ID
3. 掌握负载均衡和限流算法
4. 理解高可用架构设计

### 实战阶段（应用）
1. 实现经典系统设计案例
2. 分析真实系统的架构
3. 模拟系统设计面试
4. 总结架构设计的权衡

## 💡 重点难点

### 必须掌握 ⭐⭐⭐
- CAP 理论和实际应用
- 缓存三大问题及解决方案
- 分布式事务方案（Saga 推荐）
- 数据库索引设计
- 负载均衡算法
- 秒杀系统设计

### 高级主题 ⭐⭐
- Raft 算法
- Redlock 算法
- 一致性哈希
- 事件溯源（Event Sourcing）
- CQRS 模式
- 分库分表实现

### 实战技能 ⭐⭐⭐
- 容量估算
- 画架构图
- API 设计
- 权衡取舍
- 面试表达

## 🔥 常见面试题

### 理论题

1. **CAP 定理的理解？**
   - C（一致性）、A（可用性）、P（分区容错性）
   - 网络分区不可避免，实际是 CP vs AP
   - CP 系统：ZooKeeper、HBase
   - AP 系统：Cassandra、DynamoDB

2. **如何设计一个高可用系统？**
   - 消除单点故障（多实例 + 负载均衡）
   - 故障检测与恢复（健康检查 + 自动重启）
   - 容错设计（超时、重试、熔断、降级）
   - 数据冗余（主从、备份）
   - 监控告警

3. **分布式事务的方案对比？**
   - 2PC：强一致，性能差
   - TCC：最终一致，复杂
   - Saga：推荐，适合微服务
   - 本地消息表：简单可靠

### 设计题

1. **设计秒杀系统**
   - 前端：防重复点击、倒计时
   - 网关：全局限流 + 用户限流
   - 服务：Redis 预扣库存（Lua 脚本）
   - 异步：消息队列创建订单
   - 补偿：库存同步机制

2. **设计短链接系统**
   - ID 生成：Base62 编码、哈希、随机
   - 冲突处理：布隆过滤器
   - 性能优化：多级缓存
   - 统计：批量同步点击量

3. **设计分布式限流系统**
   - 固定窗口：简单但有突刺
   - 滑动窗口：精确但复杂
   - 令牌桶：平滑限流
   - 多级限流：全局 + IP + 用户

4. **设计实时消息系统**
   - WebSocket 连接管理
   - Redis Pub/Sub 消息分发
   - 离线消息存储
   - 消息状态（已读/未读）

### 优化题

1. **如何优化数据库查询性能？**
   - EXPLAIN 分析慢查询
   - 建立合适的索引
   - 避免 SELECT *
   - 使用缓存
   - 读写分离

2. **缓存和数据库一致性如何保证？**
   - 先更新数据库，再删除缓存（推荐）
   - 延迟双删（解决并发问题）
   - 会话一致性（短时间读主库）

3. **如何实现分布式锁？**
   - Redis：SET NX PX + Lua 脚本
   - Redlock：多节点防单点
   - 自动续期（Watchdog）

## 📊 内容统计

- **5 个核心主题**
- **200+ 页详细内容**
- **100+ 个代码示例**
- **25+ 道高频面试题**
- **5 个完整实战案例**

## 🎓 系统设计面试流程

### 1. 需求澄清（5 分钟）
- 功能需求
- 非功能需求（QPS、延迟、可用性）
- 规模估算（用户量、数据量、带宽）

### 2. 高层设计（10-15 分钟）
- 画架构图（客户端、服务器、数据库、缓存）
- 说明各组件职责
- 描述数据流

### 3. 详细设计（20-25 分钟）
- API 设计
- 数据模型设计
- 核心算法
- 扩展性讨论

### 4. 深入讨论（10 分钟）
- 性能优化
- 容错处理
- 监控告警
- 权衡取舍

## 📚 推荐资源

### 书籍
- 《设计数据密集型应用》（Designing Data-Intensive Applications）
- 《System Design Interview》 - Alex Xu
- 《微服务设计》（Building Microservices）

### 网站
- [System Design Primer](https://github.com/donnemartin/system-design-primer)
- [高可用架构](https://www.infoq.cn/topic/architecture)
- [ByteByteGo](https://bytebytego.com/)

### 实践
- 分析知名系统的架构（Twitter、Instagram、Uber）
- 参与开源项目
- 模拟系统设计面试

## ✅ 检查清单

完成以下内容后，你应该能够：

### 理论知识
- [ ] 理解 CAP 和 BASE 理论
- [ ] 掌握分布式一致性算法
- [ ] 理解分布式事务方案
- [ ] 掌握缓存策略

### 设计能力
- [ ] 画出清晰的架构图
- [ ] 设计合理的 API
- [ ] 设计高效的数据模型
- [ ] 进行容量估算

### 实战经验
- [ ] 实现过秒杀系统
- [ ] 实现过分布式锁
- [ ] 优化过数据库查询
- [ ] 设计过缓存方案

### 面试技巧
- [ ] 能够流畅表达设计思路
- [ ] 能够分析权衡取舍
- [ ] 能够回答追问
- [ ] 能够主动提出优化方案

## 🎯 面试评分标准

### 初级（0-2 年）
- 理解基本概念（缓存、数据库、负载均衡）
- 能设计简单系统（CRUD API）
- 了解常见架构模式

### 中级（2-4 年）
- 深入理解分布式系统概念
- 能设计中等复杂系统（秒杀、短链接）
- 掌握性能优化技巧
- 理解 CAP 和 BASE

### 高级（4+ 年）
- 精通系统设计方法论
- 能设计大规模分布式系统
- 深入理解一致性算法
- 有实际架构设计经验
- 能够权衡取舍并说明理由
- 能够指导他人进行系统设计

## 🚀 下一步

完成本模块后，建议：
1. 实现至少 3 个经典案例
2. 模拟 10+ 次系统设计面试
3. 阅读《设计数据密集型应用》
4. 分析 3 个知名系统的架构
5. 总结自己的架构设计模板

---

**上一模块**：[14-algorithms-data-structures（算法）](../14-algorithms-data-structures/README.md)  
**下一模块**：[16-architecture（架构）](../16-architecture/README.md)
