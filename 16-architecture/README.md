# 架构设计

架构设计是构建高质量软件系统的核心能力。本模块深入讲解架构模式、分层架构、DDD、微服务和设计原则。

## 📚 学习文档

### ✅ 已完成

1. **[架构模式](./01-architecture-patterns.md)** (50KB)
   - 单体架构（特点、优缺点、模块化单体）
   - 微服务架构（服务拆分、通信、数据管理）
   - SOA 架构（ESB、与微服务对比）
   - Serverless 架构（FaaS、BaaS、Lambda）
   - 事件驱动架构（Event Sourcing、CQRS、Saga）
   - 架构选型决策树
   - 5+ 道高频面试题

2. **[分层架构](./02-layered-architecture.md)** (48KB)
   - 传统三层架构
   - MVC 架构
   - 洋葱架构（依赖倒置）
   - 六边形架构（端口-适配器）
   - Clean Architecture（依赖规则、各层职责）
   - NestJS 实现 Clean Architecture
   - 5+ 道高频面试题

3. **[领域驱动设计（DDD）](./03-ddd.md)** (50KB)
   - DDD 核心概念（通用语言）
   - 战略设计（限界上下文、上下文映射）
   - 实体与值对象
   - 聚合与聚合根
   - 领域服务
   - 领域事件
   - 仓储模式
   - 电商系统实战案例
   - 5+ 道高频面试题

4. **[微服务深入](./04-microservices.md)** (48KB)
   - 服务拆分原则和粒度
   - 服务通信（REST、gRPC、消息队列）
   - 服务发现（Consul、Kubernetes）
   - 配置管理（ConfigMap、Consul KV）
   - API 网关（Kong、自定义）
   - 熔断与限流（Circuit Breaker、令牌桶）
   - 分布式事务（Saga、TCC）
   - 部署策略（蓝绿、金丝雀）
   - 5+ 道高频面试题

5. **[设计原则](./05-design-principles.md)** (48KB)
   - SOLID 原则详解
   - DRY、KISS、YAGNI
   - 高内聚低耦合
   - 组合优于继承
   - 设计模式（工厂、单例、策略、观察者等）
   - 架构决策记录（ADR）
   - 5+ 道高频面试题

## 📝 知识点清单

### 架构模式
- [x] 单体架构
- [x] 模块化单体
- [x] 微服务架构
- [x] SOA 架构
- [x] Serverless 架构
- [x] 事件驱动架构
- [x] Event Sourcing
- [x] CQRS

### 分层架构
- [x] MVC 架构
- [x] 三层架构
- [x] 洋葱架构
- [x] 六边形架构（端口-适配器）
- [x] Clean Architecture
- [x] 依赖倒置原则

### 领域驱动设计
- [x] 通用语言
- [x] 限界上下文
- [x] 上下文映射
- [x] 实体
- [x] 值对象
- [x] 聚合与聚合根
- [x] 领域服务
- [x] 领域事件
- [x] 仓储模式

### 微服务
- [x] 服务拆分
- [x] 服务通信
- [x] 服务发现
- [x] 配置管理
- [x] API 网关
- [x] 熔断与限流
- [x] 分布式事务
- [x] 部署策略

### 设计原则
- [x] SOLID 原则
- [x] DRY
- [x] KISS
- [x] YAGNI
- [x] 高内聚低耦合
- [x] 组合优于继承
- [x] 设计模式

## 🎯 学习建议

### 基础阶段（必修）
1. 理解分层架构（三层、MVC）
2. 掌握 SOLID 原则
3. 理解单体 vs 微服务
4. 了解常用设计模式

### 进阶阶段（深入）
1. 深入理解 DDD
2. 掌握 Clean Architecture
3. 理解事件驱动架构
4. 学习微服务治理

### 实战阶段（应用）
1. 实现 Clean Architecture 项目
2. 实践 DDD 建模
3. 设计微服务系统
4. 实现分布式事务

## 💡 重点难点

### 必须掌握 ⭐⭐⭐
- 分层架构
- SOLID 原则
- 单体 vs 微服务选型
- 常用设计模式
- 服务通信方式

### 高级主题 ⭐⭐
- DDD 战略设计
- 聚合设计
- Event Sourcing
- CQRS
- Saga 模式
- 熔断与限流

### 实战技能 ⭐⭐⭐
- Clean Architecture 实现
- 微服务拆分
- API 网关配置
- 分布式事务处理

## 🔥 常见面试题

### 架构模式

1. **单体 vs 微服务，如何选择？**
   - 团队规模 < 10 人：单体
   - 业务简单、快速迭代：单体
   - 复杂业务、独立扩展：微服务
   - 运维能力强：微服务

2. **微服务的挑战？**
   - 分布式复杂性
   - 数据一致性
   - 服务发现
   - 配置管理
   - 监控追踪
   - 运维成本

3. **什么是事件溯源？**
   - 存储所有事件而非当前状态
   - 通过重放事件得到当前状态
   - 完整审计日志
   - 支持时间旅行

### 分层架构

1. **什么是依赖倒置原则？**
   - 高层不依赖低层，都依赖抽象
   - 抽象不依赖细节，细节依赖抽象

2. **洋葱架构和六边形架构的区别？**
   - 洋葱架构：同心圆分层
   - 六边形架构：端口和适配器

3. **Clean Architecture 的核心？**
   - 依赖规则：只能从外向内
   - 内层对外层一无所知

### DDD

1. **实体和值对象的区别？**
   - 实体：有唯一标识，可变
   - 值对象：无标识，不可变

2. **什么是聚合？**
   - 一组相关对象的集合
   - 通过聚合根访问
   - 一致性边界

3. **限界上下文的作用？**
   - 划分系统边界
   - 避免模型污染
   - 支持团队分工

### 设计原则

1. **SOLID 原则是什么？**
   - S：单一职责
   - O：开闭原则
   - L：里氏替换
   - I：接口隔离
   - D：依赖倒置

2. **组合和继承怎么选？**
   - 优先组合
   - is-a 关系才用继承
   - 组合更灵活

3. **什么时候抽象？**
   - Rule of Three
   - 重复三次再抽象
   - 避免过度设计

## 📊 内容统计

- **5 个核心主题**
- **244KB+ 详细内容**
- **150+ 个代码示例**
- **25+ 道高频面试题**
- **完整的实战案例**

## 🎓 技术选型建议

### 架构模式

| 场景 | 推荐架构 | 理由 |
|------|---------|------|
| **小型项目/MVP** | 单体 | 简单、快速 |
| **中型项目** | 模块化单体 | 平衡 |
| **大型项目** | 微服务 | 扩展性 |
| **事件驱动** | EDA | 解耦 |
| **不规则流量** | Serverless | 弹性 |

### 分层架构

| 复杂度 | 推荐架构 | 适用场景 |
|--------|---------|---------|
| **简单** | 三层架构 | CRUD 应用 |
| **中等** | 洋葱/六边形 | 需要灵活性 |
| **复杂** | Clean + DDD | 复杂领域 |

### 通信方式

| 场景 | 推荐方式 | 理由 |
|------|---------|------|
| **同步调用** | REST | 简单通用 |
| **高性能** | gRPC | 二进制、类型安全 |
| **异步处理** | Kafka | 可靠、高吞吐 |
| **聚合查询** | GraphQL | 灵活查询 |

## ✅ 检查清单

### 架构模式
- [ ] 理解各种架构模式
- [ ] 能根据场景选择架构
- [ ] 理解事件驱动架构
- [ ] 了解 CQRS 和事件溯源

### 分层架构
- [ ] 理解各种分层架构
- [ ] 掌握依赖倒置原则
- [ ] 能实现端口和适配器
- [ ] 理解 Clean Architecture

### DDD
- [ ] 理解通用语言
- [ ] 识别限界上下文
- [ ] 区分实体和值对象
- [ ] 设计合理的聚合
- [ ] 实现领域事件
- [ ] 使用仓储模式

### 微服务
- [ ] 合理拆分服务
- [ ] 选择通信方式
- [ ] 实现服务发现
- [ ] 配置 API 网关
- [ ] 实现熔断限流
- [ ] 处理分布式事务

### 设计原则
- [ ] 理解 SOLID 原则
- [ ] 掌握常用设计模式
- [ ] 能识别代码坏味道
- [ ] 能进行合理重构

## 📚 推荐资源

### 书籍
- 《领域驱动设计》 - Eric Evans
- 《实现领域驱动设计》 - Vaughn Vernon
- 《Clean Architecture》 - Robert C. Martin
- 《微服务架构设计模式》 - Chris Richardson
- 《设计模式》 - GoF

### 文档
- [Martin Fowler's Blog](https://martinfowler.com/)
- [DDD Reference](https://domainlanguage.com/ddd/reference/)
- [Microservices.io](https://microservices.io/)
- [The Twelve-Factor App](https://12factor.net/)

## 🚀 下一步

完成本模块后，建议：
1. 用 Clean Architecture 重构现有项目
2. 实践 DDD 建模方法
3. 设计一个微服务系统
4. 学习 Kubernetes 部署
5. 深入学习分布式系统
6. 了解云原生架构

## 🎯 面试评分标准

### 初级（0-2 年）
- 理解分层架构
- 知道 SOLID 原则
- 了解单体和微服务
- 知道常用设计模式

### 中级（2-4 年）
- 深入理解分层架构
- 能实践 DDD
- 有微服务经验
- 能做架构决策

### 高级（4+ 年）
- 精通 DDD
- 有大规模系统设计经验
- 能指导团队架构
- 能平衡技术和业务
- 有架构演进经验

## 💡 架构格言

> "All architecture is design, but not all design is architecture." — Grady Booch

> "The goal of software architecture is to minimize the human resources required to build and maintain the required system." — Robert C. Martin

> "Make it work, make it right, make it fast." — Kent Beck

---

**上一模块**：[15-system-design（系统设计）](../15-system-design/README.md)  
**下一模块**：[17-tools-skills（工具与技能）](../17-tools-skills/README.md)
